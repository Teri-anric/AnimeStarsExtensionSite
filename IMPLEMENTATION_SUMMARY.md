# –ü—ñ–¥—Å—É–º–æ–∫ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Ñ–∞–π–ª–æ–≤–æ–≥–æ —Å—Ö–æ–≤–∏—â–∞

## ‚úÖ –©–æ –±—É–ª–æ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ

### 1. –ú–æ–¥—É–ª—å–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Å—Ö–æ–≤–∏—â–∞
- **`backend/app/storage/base.py`** - –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–∏–π –±–∞–∑–æ–≤–∏–π –∫–ª–∞—Å `BaseStorageService`
- **`backend/app/storage/local.py`** - —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å—Ö–æ–≤–∏—â–∞ `LocalStorageService`
- **`backend/app/storage/__init__.py`** - –µ–∫—Å–ø–æ—Ä—Ç –∫–ª–∞—Å—ñ–≤

### 2. –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
- **`backend/app/config.py`** - –¥–æ–¥–∞–Ω–æ `StorageSettings` –∑ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è–º–∏:
  - `path: str = "/storage"` - —à–ª—è—Ö –¥–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è
  - `base_url: str = "/static/storage"` - –±–∞–∑–æ–≤–∏–π URL –¥–ª—è –¥–æ—Å—Ç—É–ø—É

### 3. –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –≤ FastAPI
- **`backend/app/web/deps.py`** - –¥–æ–¥–∞–Ω–æ –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å `StorageServiceDep`
- **`backend/app/web/main.py`** - –¥–æ–¥–∞–Ω–æ –º–æ–Ω—Ç—É–≤–∞–Ω–Ω—è —Å—Ç–∞—Ç–∏—á–Ω–æ—ó –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó
- **`backend/app/web/api/files.py`** - –Ω–æ–≤–∏–π —Ä–æ—É—Ç–µ—Ä –∑ –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∞–º–∏:
  - `POST /api/files/upload` - –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤
  - `DELETE /api/files/{file_path}` - –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤
- **`backend/app/web/api/__init__.py`** - –¥–æ–¥–∞–Ω–æ files —Ä–æ—É—Ç–µ—Ä

### 4. Docker —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è
- **`docker-compose.yaml`** - –¥–æ–¥–∞–Ω–æ —ñ–º–µ–Ω–æ–≤–∞–Ω–∏–π volume `local_storage`
- –ú–æ–Ω—Ç—É–≤–∞–Ω–Ω—è volume –≤ backend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä: `local_storage:/storage`

### 5. –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
- **`backend/requirements.txt`** - –¥–æ–¥–∞–Ω–æ `aiofiles` –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ –∑ —Ñ–∞–π–ª–∞–º–∏

### 6. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è —Ç–∞ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
- **`backend/STORAGE_README.md`** - –ø–æ–≤–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è API —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
- **`backend/test_storage.py`** - —Ç–µ—Å—Ç–æ–≤–∏–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—ñ

## üîß –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å

### API –ï–Ω–¥–ø–æ—ñ–Ω—Ç–∏

#### –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É
```http
POST /api/files/upload
Content-Type: multipart/form-data
Authorization: Bearer <token>

file: <—Ñ–∞–π–ª>
```

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
    "success": true,
    "file_url": "/static/storage/2024/01/15/uuid-filename.jpg",
    "file_path": "2024/01/15/uuid-filename.jpg",
    "filename": "original-filename.jpg",
    "size": 12345,
    "content_type": "image/jpeg"
}
```

#### –í–∏–¥–∞–ª–µ–Ω–Ω—è —Ñ–∞–π–ª—É
```http
DELETE /api/files/{file_path}
Authorization: Bearer <token>
```

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
    "success": true,
    "message": "–§–∞–π–ª —É—Å–ø—ñ—à–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–æ"
}
```

### –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó

1. **–ë–µ–∑–ø–µ–∫–∞:**
   - –í—Å—ñ –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
   - –û–±–º–µ–∂–µ–Ω–Ω—è —Ä–æ–∑–º—ñ—Ä—É —Ñ–∞–π–ª—É (10MB)
   - –£–Ω—ñ–∫–∞–ª—å–Ω—ñ —ñ–º–µ–Ω–∞ —Ñ–∞–π–ª—ñ–≤ (UUID)

2. **–û—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è —Ñ–∞–π–ª—ñ–≤:**
   - –Ü—î—Ä–∞—Ä—Ö—ñ—á–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞ –¥–∞—Ç–æ—é: `/storage/YYYY/MM/DD/`
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ–π

3. **–ú–æ–¥—É–ª—å–Ω—ñ—Å—Ç—å:**
   - –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω–∏–π –±–∞–∑–æ–≤–∏–π –∫–ª–∞—Å –¥–ª—è –ª–µ–≥–∫–æ—ó –∑–∞–º—ñ–Ω–∏ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó
   - Dependency injection –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è

4. **–°—Ç—ñ–π–∫—ñ—Å—Ç—å:**
   - Docker volume –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É
   - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ —Ä–æ–±–æ—Ç–∞ –∑ —Ñ–∞–π–ª–∞–º–∏

## üöÄ –Ø–∫ –∑–∞–ø—É—Å—Ç–∏—Ç–∏

1. **–ó–∞–ø—É—Å–∫ –≤ Docker:**
   ```bash
   docker compose up -d backend
   ```

2. **–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è:**
   ```bash
   # –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ backend
   python test_storage.py
   ```

3. **–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è API:**
   ```bash
   # –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É
   curl -X POST "http://localhost:8000/api/files/upload" \
        -H "Authorization: Bearer <token>" \
        -F "file=@/path/to/file.jpg"
   ```

## üîÆ –ú–∞–π–±—É—Ç–Ω—ñ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –¥–ª—è:
- –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó –∑ —Ö–º–∞—Ä–Ω–∏–º–∏ —Å—Ö–æ–≤–∏—â–∞–º–∏ (AWS S3, Google Cloud Storage)
- –î–æ–¥–∞–≤–∞–Ω–Ω—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó —Ç–∏–ø—ñ–≤ —Ñ–∞–π–ª—ñ–≤
- –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó –∫–µ—à—É–≤–∞–Ω–Ω—è
- –î–æ–¥–∞–≤–∞–Ω–Ω—è –º–µ—Ç–∞–¥–∞–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤
- –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó –∑ —ñ–Ω—à–∏–º–∏ —á–∞—Å—Ç–∏–Ω–∞–º–∏ –¥–æ–¥–∞—Ç–∫—É (–∞–≤–∞—Ç–∞—Ä–∏, —Ñ–∞–π–ª–∏ —á–∞—Ç—É)

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª—ñ–≤

```
backend/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ storage/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ local.py
‚îÇ   ‚îî‚îÄ‚îÄ web/
‚îÇ       ‚îú‚îÄ‚îÄ api/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ files.py
‚îÇ       ‚îú‚îÄ‚îÄ deps.py
‚îÇ       ‚îî‚îÄ‚îÄ main.py
‚îú‚îÄ‚îÄ config.py
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ test_storage.py
‚îî‚îÄ‚îÄ STORAGE_README.md
```

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —ñ –≥–æ—Ç–æ–≤–∞ –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è!** üéâ